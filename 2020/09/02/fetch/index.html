
<!DOCTYPE html>
<html lang="zh-CN" class="loading">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Fetchç¬”è®° - myjdml&#39;s blog</title>
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="google" content="notranslate" />
    <meta name="keywords" content="Fechin,"> 
    <meta name="description" content="å…³äºAJAXçš„ä¸€äº›å›é¡¾
åŸºæœ¬æ­¥éª¤ï¼š  
è¿›è¡ŒAjaxè¯·æ±‚ç›¸ä¿¡å¤§å®¶ä¸€å®šä¸é™Œç”Ÿï¼Œè¿™é‡Œæˆ‘ä»¬ä¸€èµ·å›é¡¾ä¸€ä¸‹ï¼Œajaxè¯·æ±‚æ˜¯ä»€ä¹ˆæ ·çš„ï¼
1234567891011121314151617181920212223,"> 
    <meta name="author" content="Yaojun Mao"> 
    <link rel="alternative" href="atom.xml" title="myjdml&#39;s blog" type="application/atom+xml"> 
    <link rel="icon" href="/img/favicon.png"> 
    
<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css">

    
<link rel="stylesheet" href="/css/diaspora.css">

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
         (adsbygoogle = window.adsbygoogle || []).push({
              google_ad_client: "ca-pub-8691406134231910",
              enable_page_level_ads: true
         });
    </script>
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
<meta name="generator" content="Hexo 5.1.1"></head>

<body class="loading">
    <span id="config-title" style="display:none">myjdml&#39;s blog</span>
    <div id="loader"></div>
    <div id="single">
    <div id="top" style="display: block;">
    <div class="bar" style="width: 0;"></div>
    <a class="iconfont icon-home image-icon" href="javascript:;" data-url="http://yoursite.com"></a>
    <div title="æ’­æ”¾/æš‚åœ" class="iconfont icon-play"></div>
    <h3 class="subtitle">Fetchç¬”è®°</h3>
    <div class="social">
        <div>
            <div class="share">
                <a title="è·å–äºŒç»´ç " class="iconfont icon-scan" href="javascript:;"></a>
            </div>
            <div id="qr"></div>
        </div>
    </div>
    <div class="scrollbar"></div>
</div>

    <div class="section">
        <div class="article">
    <div class='main'>
        <h1 class="title">Fetchç¬”è®°</h1>
        <div class="stuff">
            <span>ä¹æœˆ 02, 2020</span>
            
  <ul class="post-tags-list" itemprop="keywords"><li class="post-tags-list-item"><a class="post-tags-list-link" href="/tags/Ajax/" rel="tag">Ajax</a></li><li class="post-tags-list-item"><a class="post-tags-list-link" href="/tags/Fetch/" rel="tag">Fetch</a></li><li class="post-tags-list-item"><a class="post-tags-list-link" href="/tags/js/" rel="tag">js</a></li></ul>


        </div>
        <div class="content markdown">
            <h2 id="å…³äºAJAXçš„ä¸€äº›å›é¡¾"><a href="#å…³äºAJAXçš„ä¸€äº›å›é¡¾" class="headerlink" title="å…³äºAJAXçš„ä¸€äº›å›é¡¾"></a>å…³äºAJAXçš„ä¸€äº›å›é¡¾</h2><p><img src="/images/Fetch/ajax.jpg" alt="ajax"></p>
<p>åŸºæœ¬æ­¥éª¤ï¼š  </p>
<p>è¿›è¡ŒAjaxè¯·æ±‚ç›¸ä¿¡å¤§å®¶ä¸€å®šä¸é™Œç”Ÿï¼Œè¿™é‡Œæˆ‘ä»¬ä¸€èµ·å›é¡¾ä¸€ä¸‹ï¼Œajaxè¯·æ±‚æ˜¯ä»€ä¹ˆæ ·çš„ï¼</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> btn = <span class="built_in">document</span>.querySelector(<span class="string">&quot;#btn&quot;</span>);</span><br><span class="line">btn.addEventListener(<span class="string">&#x27;click&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> username = <span class="built_in">document</span>.querySelector(<span class="string">&quot;#username&quot;</span>).value;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">     <span class="comment">// //1.åˆ›å»ºä¸€ä¸ªæ–°çš„XMLHttpRequestå¯¹è±¡</span></span><br><span class="line">     <span class="comment">// let xhr = new XMLHttpRequest();</span></span><br><span class="line">     <span class="comment">// //æŒ‡å®šå‘é€</span></span><br><span class="line">     <span class="comment">// xhr.open(&quot;get&quot;, &quot;../php/checkUsername.php?username=&quot; + username, true);</span></span><br><span class="line">     <span class="comment">// //å‘é€</span></span><br><span class="line">     <span class="comment">// xhr.send(null);</span></span><br><span class="line">     <span class="comment">// //å‘é€æˆåŠŸéœ€è¦æ‰§è¡Œçš„ä»£ç </span></span><br><span class="line">     <span class="comment">// xhr.onreadystatechange = function () &#123;</span></span><br><span class="line">     <span class="comment">//     let result = xhr.responseText;</span></span><br><span class="line">     <span class="comment">//     document.querySelector(&quot;#result&quot;).innerHTML = result;</span></span><br><span class="line">     <span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//1.åˆ›å»ºä¸€ä¸ªæ–°çš„XMLHttpRequestå¯¹è±¡</span></span><br><span class="line">    <span class="keyword">let</span> xhr = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">window</span>.XMLHttpRequest) &#123;</span><br><span class="line">        xhr = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">//å…¼å®¹IE6</span></span><br><span class="line">        xhr = <span class="keyword">new</span> ActiveXObject(<span class="string">&quot;Microsoft.XMLHTTP&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å¯¹äºget</span></span><br><span class="line">        <span class="comment">//2.å‡†å¤‡å‘é€</span></span><br><span class="line">        xhr.open(<span class="string">&quot;get&quot;</span>, <span class="string">&quot;../php/checkUsername.php?username=&quot;</span> + username, <span class="literal">true</span>);</span><br><span class="line">        <span class="comment">//3.æ‰§è¡Œå‘é€</span></span><br><span class="line">        xhr.send(<span class="literal">null</span>);</span><br><span class="line">    <span class="comment">//å¯¹äºpost</span></span><br><span class="line">        <span class="comment">//2.å‡†å¤‡å‘é€</span></span><br><span class="line">        xhr.open(<span class="string">&quot;post&quot;</span>, <span class="string">&quot;../php/checkUsername.php&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">        <span class="comment">//3.æ‰§è¡Œå‘é€</span></span><br><span class="line">        <span class="keyword">let</span> param = <span class="string">&quot;username=&quot;</span> + username;</span><br><span class="line">        <span class="comment">//å¯¹äºpostè¯·æ±‚æ¥è¯´ï¼Œå‚æ•°åº”è¯¥æ”¾åœ¨è¯·æ±‚ä½“å½“ä¸­ã€‚</span></span><br><span class="line">        <span class="comment">//è®¾ç½®xhrè¯·æ±‚ä¿¡æ¯ï¼Œåªæœ‰postè¯·æ±‚æœ‰</span></span><br><span class="line">        xhr.setRequestHeader(<span class="string">&quot;Content-type&quot;</span>, <span class="string">&quot;application/x-www-form-urlencoded&quot;</span>);</span><br><span class="line">        xhr.send(param);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//4.è®¾ç½®å›è°ƒå‡½æ•°</span></span><br><span class="line">    xhr.onreadystatechange = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (xhr.readyState === <span class="number">4</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (xhr.status === <span class="number">200</span>) &#123;</span><br><span class="line">                <span class="keyword">let</span> result = xhr.responseText;</span><br><span class="line">                <span class="built_in">document</span>.querySelector(<span class="string">&quot;#result&quot;</span>).innerHTML = result;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="Fetch-Fetch-Fetchï¼ï¼ï¼"><a href="#Fetch-Fetch-Fetchï¼ï¼ï¼" class="headerlink" title="Fetch Fetch Fetchï¼ï¼ï¼"></a>Fetch Fetch Fetchï¼ï¼ï¼</h2><p>å½“æˆ‘ä»¬ä½¿ç”¨javascriptå»å‘é€å’Œæ¥æ”¶ä¸€äº›ä¿¡æ¯çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¼šå‘èµ·ä¸€ä¸ªå«åšajaxè¯·æ±‚çš„ä¸œè¥¿ã€‚ajaxæ˜¯ä¸€ç§æŠ€æœ¯ï¼Œå½“æˆ‘ä»¬éœ€è¦å‘é€å’Œæ¥æ”¶ä¿¡æ¯æ—¶ï¼Œä¿¡æ¯è¿”å›å›æ¥ï¼Œæˆ‘ä»¬éœ€è¦æ”¹å˜HTMLï¼Œå°†å®ƒæ·»åŠ åˆ°é¡µé¢ä¸­ã€‚è¿™ä¸ªæ—¶å€™æµè§ˆå™¨å¾€å¾€éœ€è¦é‡æ–°æ¸²æŸ“ã€‚è€Œæˆ‘ä»¬å¦‚æœä½¿ç”¨äº†ajaxæŠ€æœ¯çš„è¯ï¼Œæµè§ˆå™¨ä¸éœ€è¦å»é‡æ–°åˆ·æ–°é¡µé¢ï¼Œè€Œæ˜¯åªæ”¹å˜éœ€è¦æ›´æ–°çš„éƒ¨åˆ†ï¼Œè®©é¡µé¢å±€éƒ¨åˆ·æ–°ã€‚  </p>
<p>ç”±äºåŸç”Ÿçš„jsä»£ç å®ç°ajaxååˆ†çš„ç¹çï¼Œå¹¶ä¸”æœ‰å„ç§é€‚é…çš„é—®é¢˜ï¼Œæ‰€ä»¥Jqueryå°è£…åº“å®ç°ajaxæ¨ªç©ºå‡ºä¸–ï¼Œåœ¨å½“æ—¶æˆä¸ºäº†ä¸€è‚¡æ½®æµã€‚å®ƒåªéœ€è¦å¼•å…¥Jqueryæ–‡ä»¶ï¼Œè¿›è¡Œä¸€äº›ç®€å•çš„é…ç½®ï¼Œå°±å¯ä»¥å®ç°ajaxå¼‚æ­¥è¯·æ±‚ã€‚  </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$.ajax(<span class="string">&#x27;some-url&#x27;</span>, &#123;</span><br><span class="line">  success: <span class="function">(<span class="params">data</span>) =&gt;</span> &#123; <span class="comment">/* do something with the data */</span> &#125;,</span><br><span class="line">  error: <span class="function">(<span class="params">err</span>) =&gt;</span> &#123; <span class="comment">/* do something when an error happens */</span>&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="Fetchçš„æ”¯æŒ"><a href="#Fetchçš„æ”¯æŒ" class="headerlink" title="Fetchçš„æ”¯æŒ"></a>Fetchçš„æ”¯æŒ</h3><p><img src="/images/Fetch/brower.png" alt="image"></p>
<p>Fetchçš„æ”¯æŒæ€§éå¸¸å¥½ï¼Œæ”¯æŒå‡ ä¹æ‰€æœ‰çš„ä¸»æµæµè§ˆå™¨ï¼ˆè€ç‰ˆçš„IEå’Œè¿·ä½ ç‰ˆçš„æ¬§æœ‹é™¤å¤–ï¼‰ã€‚è€Œä¸”å› ä¸ºFetchæ˜¯åŸç”Ÿçš„æ–¹æ³•ï¼Œæ‰€ä»¥å®ƒåœ¨é¡¹ç›®ä¸­ä½¿ç”¨ååˆ†çš„å®‰å…¨ã€‚å¦‚æœä½ éœ€è¦ä½¿ç”¨ä¸€äº›æ–¹æ³•ï¼ŒåŸç”Ÿä¸æ”¯æŒã€‚è¿™é‡Œæœ‰ä¸€äº›<a target="_blank" rel="noopener" href="https://github.com/github/fetch">è¡¥å……</a>  </p>
<h3 id="ä½¿ç”¨Fetchè·å–æ•°æ®"><a href="#ä½¿ç”¨Fetchè·å–æ•°æ®" class="headerlink" title="ä½¿ç”¨Fetchè·å–æ•°æ®"></a>ä½¿ç”¨Fetchè·å–æ•°æ®</h3><p>ä½¿ç”¨Fetchè·å–æ•°æ®å¾ˆå®¹æ˜“ï¼Œåªéœ€è¦çŸ¥é“èµ„æºåœ°å€å°±å¯ä»¥  </p>
<p>ä¾‹å¦‚æˆ‘æƒ³è·å–åˆ°Chrisçš„ä»“åº“çš„æ•°æ®ï¼Œæˆ‘åªéœ€è¦å‘é€ä¸€ä¸ªgetè¯·æ±‚ç»™<code>api.github.com/users/chriscoyier/repos</code>  </p>
<p>è¿™æ ·å°±æ˜¯ä¸€ä¸ªfetchè¯·æ±‚ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fetch(<span class="string">&#x27;https://api.github.com/users/chriscoyier/repos&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>è¿™æ˜¯ä¸æ˜¯å¾ˆç®€å•ï¼ï¼ï¼  </p>
<p>æ¥ä¸‹æ¥Fetchè¿”å›çš„æ˜¯ä¸€ä¸ªPromiseå¯¹è±¡ï¼Œè¿™æ˜¯ä¸€ä¸ªä¸éœ€è¦å›è°ƒå‡½æ•°å°±å¯ä»¥æ“ä½œå¼‚æ­¥æ–¹æ³•çš„å¯¹è±¡ã€‚  </p>
<p>è·å–åˆ°æ•°æ®ä¹‹åï¼Œæˆ‘ä»¬å°†æˆ‘ä»¬éœ€è¦è¿›è¡Œçš„ä¸€äº›æ“ä½œæ”¾åœ¨<code>.then</code>æ–¹æ³•é‡Œ  </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">fetch(<span class="string">&#x27;https://api.github.com/users/chriscoyier/repos&#x27;</span>)</span><br><span class="line">  .then(<span class="function"><span class="params">response</span> =&gt;</span> &#123;<span class="comment">/* do something */</span>&#125;)</span><br></pre></td></tr></table></figure>

<p>å¦‚æœä½ æ˜¯ç¬¬ä¸€æ¬¡ä½¿ç”¨fetchï¼Œä½ ä¼šå¯¹å®ƒè¿”å›çš„responseååˆ†æƒŠå–œã€‚å¦‚æœä½ ä½¿ç”¨<code>console.log(response)</code>ï¼Œä½ å°†å¾—åˆ°ä¸‹é¢è¿™äº›ä¿¡æ¯</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  body: ReadableStream</span><br><span class="line">  bodyUsed: <span class="literal">false</span></span><br><span class="line">  headers: Headers</span><br><span class="line">  ok : <span class="literal">true</span></span><br><span class="line">  redirected : <span class="literal">false</span></span><br><span class="line">  status : <span class="number">200</span></span><br><span class="line">  statusText : <span class="string">&quot;OK&quot;</span></span><br><span class="line">  type : <span class="string">&quot;cors&quot;</span></span><br><span class="line">  url : <span class="string">&quot;http://some-website.com/some-url&quot;</span></span><br><span class="line">  __proto__ : Response</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œï¼Œä½ ä¼šçœ‹åˆ°fetchä¼šè¿”å›ç»™ä½ ä¸€äº›å‚æ•°ï¼Œè¿™äº›å‚æ•°ä¼šå‘Šè¯‰ä½ è¯·æ±‚çš„çŠ¶æ€ã€‚ä½ ä¼šçœ‹åˆ°è¯·æ±‚æˆåŠŸï¼ˆok: true; status: 200ï¼‰ã€‚ä½†æ˜¯ä½ ä¹Ÿè®¸æ³¨æ„åˆ°äº†, åœ¨è¿™äº›å‚æ•°ä¸­ä½ çœ‹ä¸åˆ°ä»»ä½•ä½ è¯·æ±‚æˆåŠŸçš„æ•°æ®ï¼ï¼  </p>
<p>äº‹å®å°±æ˜¯å¦‚æ­¤ï¼Œæˆ‘ä»¬ä»GitHubè·å–çš„æ•°æ®éšè—åœ¨bodyçš„å¯è¯»æ–‡æ¡£æµä¸­ã€‚æˆ‘ä»¬éœ€è¦ä¸€ä¸ªåˆé€‚çš„æ–¹æ³•å»è½¬æ¢è¿™äº›æ–‡æ¡£æµï¼Œè®©å®ƒä»¬å˜æˆæˆ‘ä»¬å¯ä»¥ä½¿ç”¨çš„æ•°æ®ã€‚<br>æˆ‘ä»¬çŸ¥é“GitHubè¿”å›çš„æ˜¯ä¸€ä¸²jsonæ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>response.json</code>æ¥è½¬æ¢è¿™äº›æ•°æ®ã€‚  </p>
<p>è¿™é‡Œæœ‰ä¸€äº›å…¶ä»–çš„æ–¹æ³•å»å¤„ç†ä¸åŒç±»å‹çš„æ•°æ®ã€‚å¦‚æœè¿”å›çš„æ•°æ®æ˜¯XMLæ ¼å¼çš„ã€‚å¯ä»¥ç”¨<code>response.text</code>è¿›è¡Œæ•°æ®è½¬æ¢ï¼›å¦‚æœè¿”å›çš„æ•°æ®æ˜¯å›¾ç‰‡ã€‚å¯ä»¥ç”¨<code>response.blob</code>  </p>
<p>æ‰€æœ‰çš„è¿™äº›è½¬æ¢æ–¹æ³•ï¼ˆ<code>response.json</code> æˆ–è€…å…¶ä»–æ‰€æœ‰çš„ï¼‰è¿”å›çš„éƒ½æ˜¯å¦ä¸€ä¸ªPromiseå¯¹è±¡ï¼Œæˆ‘ä»¬å¯ä»¥å†ç”¨ä¸€ä¸ª<code>.then</code>æ–¹æ³•æ¥è·å–è¿™äº›æ•°æ®ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">fetch(<span class="string">&#x27;https://api.github.com/users/chriscoyier/repos&#x27;</span>)</span><br><span class="line">  .then(<span class="function"><span class="params">response</span> =&gt;</span> response.json())</span><br><span class="line">  .then(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// Here&#x27;s a list of repos!</span></span><br><span class="line">    <span class="built_in">console</span>.log(data)</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>

<p>OK!!è¿™å°±æ˜¯ä¸€ä¸ªå®Œæ•´çš„ç”¨fetchè¿›è¡Œå¼‚æ­¥æ“ä½œçš„ä»£ç äº†ã€‚ç®€çŸ­ä¸”ç®€å•ğŸ§²</p>
<h3 id="ç”¨Fetchå‘é€æ•°æ®"><a href="#ç”¨Fetchå‘é€æ•°æ®" class="headerlink" title="ç”¨Fetchå‘é€æ•°æ®"></a>ç”¨Fetchå‘é€æ•°æ®</h3><p>ä½¿ç”¨fetchå‘é€æ¶ˆæ¯æ˜¯ååˆ†ä¼˜é›…çš„ï¼Œä½ å¯ä»¥åªéœ€è¦é…ç½®ä¸€ä¸‹é…ç½®é¡¹å°±å¯ä»¥ä½¿ç”¨ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fetch(<span class="string">&#x27;some-url&#x27;</span>, options);</span><br></pre></td></tr></table></figure>

<p>ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œä½ éœ€è¦è®¾ç½®ä½ æäº¤è¯·æ±‚çš„æ–¹å¼ã€‚å¦‚æœä½ æ²¡æœ‰è®¾ç½®ï¼Œfetchä¼šè‡ªåŠ¨å°†è®¾ç½®ä¸ºget  </p>
<p>ç¬¬äºŒä¸ªå‚æ•°ï¼Œè®¾ç½®ä½ çš„è¯·æ±‚å¤´ã€‚åœ¨ç°åœ¨è¿™ä¸ªæ—¶é—´æ®µï¼Œæˆ‘ä»¬ä¸»è¦ç”¨çš„æ˜¯jsonæ•°æ®ã€‚æ‰€ä»¥æˆ‘ä»¬å°±è®¾ç½®<code>content-Type</code>ä¸º<code>application/json</code>  </p>
<p>ç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œè®¾ç½®çš„æ˜¯bodyé‡Œçš„jsonæ•°æ®å¤„ç†ã€‚æˆ‘ä»¬ä½¿ç”¨jsonæ•°æ®çš„æ—¶å€™é€šå¸¸è¦è¿›è¡Œä¸€äº›å¤„ç†ã€‚æ‰€ä»¥æˆ‘ä»¬é€šå¸¸ä¼šè®¾ç½®<code>JSON.stringify</code>  </p>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªpostè¯·æ±‚çš„å®ä¾‹ï¼š  </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> content = &#123;<span class="attr">some</span>: <span class="string">&#x27;content&#x27;</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// The actual fetch request</span></span><br><span class="line">fetch(<span class="string">&#x27;some-url&#x27;</span>, &#123;</span><br><span class="line">  method: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">  headers: &#123;</span><br><span class="line">    <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  body: <span class="built_in">JSON</span>.stringify(content)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// .then()...</span></span><br></pre></td></tr></table></figure>

<p>å¦‚æœä½ çš„çœ¼å…‰è¶³å¤Ÿæ•é”ï¼Œä½ å°±ä¼šå‘ç°æœ‰ä¸€äº›æ¨¡ç‰ˆä»£ç å¯¹äºå¾ˆå¤š<code>post</code>,<code>put</code>å’Œ<code>delete</code>è¯·æ±‚éƒ½é€‚ç”¨ã€‚å½“æˆ‘ä»¬å·²ç»æ˜ç¡®äº†æˆ‘ä»¬ä¼šå‘é€jsonæ•°æ®çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥é‡å¤çš„å°†å¤´éƒ¨è®¾ç½®ä¸º<code>JSON.stringify</code>  </p>
<p>ä½†æ˜¯å³ä½¿æˆ‘ä»¬ä½¿ç”¨æ¨¡æ¿ä»£ç ï¼Œfetchä¾ç„¶å¯ä»¥æŠŠå¼‚æ­¥è¯·æ±‚å®ç°çš„å¾ˆå¥½ã€‚  </p>
<p>ç„¶è€Œå½“ä½¿ç”¨fetchçš„æ—¶å€™å¤„ç†é”™è¯¯ä¿¡æ¯çš„æ—¶å€™ï¼Œå¹¶æ²¡æœ‰åƒå¤„ç†æˆåŠŸä¿¡æ¯è¿™ä¹ˆå®¹æ˜“ã€‚ã€‚ã€‚  </p>
<h3 id="ä½¿ç”¨fetchå¤„ç†é”™è¯¯ä¿¡æ¯"><a href="#ä½¿ç”¨fetchå¤„ç†é”™è¯¯ä¿¡æ¯" class="headerlink" title="ä½¿ç”¨fetchå¤„ç†é”™è¯¯ä¿¡æ¯"></a>ä½¿ç”¨fetchå¤„ç†é”™è¯¯ä¿¡æ¯</h3><p>å°½ç®¡æˆ‘ä»¬ä¸€ç›´å¸Œæœ›ajaxè¯·æ±‚èƒ½æˆåŠŸï¼Œä½†æ˜¯æœ‰æ—¶å€™å®ƒæ€»æ˜¯ä¼šå¤±è´¥çš„ã€‚ä¸€æ—¦å¤±è´¥ï¼Œæœ‰å¾ˆå¤šç§å¯èƒ½æ€§å¯¼è‡´fetchè¯·æ±‚å¤±è´¥ã€‚åŒ…æ‹¬å¹¶ä¸é™äºä»¥ä¸‹è¿™å‡ ç‚¹ï¼š  </p>
<ol>
<li>ä½ å°è¯•å»è¯·æ±‚ä¸€ä¸ªä¸å­˜åœ¨çš„èµ„æºã€‚</li>
<li>ä½ æ²¡æœ‰æƒé™å»è·å–èµ„æºã€‚</li>
<li>ä½ è®¾ç½®çš„ä¸€äº›çš„è¯·æ±‚å‚æ•°é”™è¯¯ã€‚</li>
<li>æœåŠ¡å™¨æŠ›å‡ºé”™è¯¯ã€‚</li>
<li>æœåŠ¡å™¨è¯·æ±‚è¶…æ—¶ã€‚</li>
<li>æœåŠ¡å™¨å®•æœºã€‚</li>
<li>åå°çš„APIæ”¹å˜</li>
<li>ã€‚ã€‚ã€‚</li>
</ol>
<p>å¦‚æœä½ çš„è¯·æ±‚å¤±è´¥äº†ï¼Œé‚£ä¹ˆå°±å¤§äº‹ä¸å¦™äº†ï¼ï¼ä½ å¯ä»¥æƒ³è±¡è¿™æ ·çš„ä¸€ç§æƒ…æ™¯ï¼Œä½ æ­£åœ¨è¿›è¡Œç½‘ä¸Šè´­ç‰©ã€‚è¿™æ—¶ï¼Œä¸€ä¸ªé”™è¯¯äº§ç”Ÿäº†ï¼Œä½†æ˜¯è®¾è®¡è¿™ä¸ªç½‘ç«™çš„äººå¹¶æ²¡æœ‰è®¾è®¡å¤„ç†è¯·æ±‚é”™è¯¯çš„å‡½æ•°ã€‚å› æ­¤ï¼Œåœ¨ä½ ç‚¹å‡»è´­ä¹°ä¹‹åï¼Œä¸€åˆ‡éƒ½é™æ­¢äº†ï¼Œä»€ä¹ˆå˜åŒ–éƒ½æ²¡æœ‰å‘ç”Ÿã€‚é‚£ä¸ªé¡µé¢å°±æŒ‚åœ¨é‚£å„¿ï¼Œä½ ä¸çŸ¥é“å‘ç”Ÿäº†ä»€ä¹ˆï¼Œä¸çŸ¥é“ä½ æ˜¯å¦è´­ä¹°æˆåŠŸäº†ã€‚  </p>
<p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬å»å°è¯•è·å–ä¸€ä¸ªä¸å­˜åœ¨çš„èµ„æºæ¥å­¦ä¹ æ¥å­¦ä¹ å¦‚ä½•åœ¨ä½¿ç”¨Fetchçš„æ—¶å€™å¤„ç†é”™è¯¯ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬é”™è¯¯çš„æŠŠ<code>chriscoyier</code>æ‹¼å†™æˆäº†<code>chrissycoyier</code>ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Fetching chrissycoyier&#x27;s repos instead of chriscoyier&#x27;s repos</span></span><br><span class="line">fetch(<span class="string">&#x27;https://api.github.com/users/chrissycoyier/repos&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>æˆ‘ä»¬çŸ¥é“è¿™ä¸ªè¯·æ±‚ä¼šäº§ç”Ÿé”™è¯¯ï¼Œå› ä¸ºåœ¨GitHubä¸Šæ˜¯æ²¡æœ‰<code>chrissycoyier</code>çš„ã€‚å› ä¸ºé”™è¯¯æ˜¯promiseå¯¹è±¡è¿”å›çš„ï¼Œæˆ‘ä»¬ä½¿ç”¨<code>catch</code>å»å¤„ç†å®ƒã€‚  </p>
<p>åœ¨ä¸çŸ¥é“å…·ä½“çš„å¤„ç†æ–¹æ³•ä¹‹å‰ï¼Œä½ å¯èƒ½ä¼šå†™å‡ºè¿™æ ·ä¸€æ®µä»£ç ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">fetch(<span class="string">&#x27;https://api.github.com/users/chrissycoyier/repos&#x27;</span>)</span><br><span class="line">  .then(<span class="function"><span class="params">response</span> =&gt;</span> response.json())</span><br><span class="line">  .then(<span class="function"><span class="params">data</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&#x27;data is&#x27;</span>, data))</span><br><span class="line">  .catch(<span class="function"><span class="params">error</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&#x27;error is&#x27;</span>, error));</span><br></pre></td></tr></table></figure>

<p>ç„¶åè§¦å‘ä½ çš„fetchè¯·æ±‚ï¼Œä½ å°†ä¼šå¾—åˆ°è¿™æ ·çš„ä¸€ä¸ªç»“æœï¼š</p>
<p><img src="/images/Fetch/error1.png" alt="image"></p>
<blockquote>
<p>Fetch failed, but the code that gets executed is the second <code>.then</code> instead of <code>.catch</code></p>
</blockquote>
<p>ä¸ºä»€ä¹ˆç¬¬äºŒä¸ª<code>.then</code>æ–¹æ³•ä¼šè°ƒç”¨æ‰§è¡Œï¼Ÿä¸ºä»€ä¹ˆpromiseä¸æƒ³æˆ‘ä»¬æ‰€æœŸæœ›çš„é‚£æ ·ä½¿ç”¨<code>.catch</code>å»æ•è·é”™è¯¯ã€‚å¤ªææ€–äº†ï¼ï¼ï¼ğŸ˜±ğŸ˜±ğŸ˜±  </p>
<p>å¦‚æœæˆ‘ä»¬ä½¿ç”¨<code>console.log</code>å»æ‰§è¡Œå“åº”å›æ¥çš„æ•°æ®ã€‚æˆ‘ä»¬ä¼šçœ‹åˆ°ä¸€äº›ä¸åŒçš„å€¼  </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  body: ReadableStream</span><br><span class="line">  bodyUsed: <span class="literal">true</span></span><br><span class="line">  headers: Headers</span><br><span class="line">  ok: <span class="literal">false</span> <span class="comment">// Response is not ok</span></span><br><span class="line">  redirected: <span class="literal">false</span></span><br><span class="line">  status: <span class="number">404</span> <span class="comment">// HTTP status is 404.</span></span><br><span class="line">  statusText: <span class="string">&quot;Not Found&quot;</span> <span class="comment">// Request not found</span></span><br><span class="line">  type: <span class="string">&quot;cors&quot;</span></span><br><span class="line">  url: <span class="string">&quot;https://api.github.com/users/chrissycoyier/repos&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™äº›æ•°æ®å¤§éƒ¨åˆ†éƒ½æ˜¯æ­£å¸¸çš„ï¼Œæ¯”å¦‚<code>ok</code>,<code>status</code>å’Œ<code>statusText</code>ã€‚å¹¶ä¸”ï¼Œå¦‚åŒæˆ‘ä»¬æ‰€é¢„æ–™æ˜¯æˆ‘ä¸€æ ·ï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰åœ¨è¿™å…¶ä¸­å‘ç°chrissycoyieråœ¨GitHubä¸Šçš„æ•°æ®ã€‚  </p>
<p>è¿™ä¸ªä¾‹å­å……åˆ†å‘Šè¯‰äº†æˆ‘ä»¬ä¸€ä»¶ååˆ†é‡è¦çš„äº‹æƒ…ï¼ŒFetchå¹¶ä¸ä¼šå…³æ³¨ä½ çš„ajaxæ˜¯å¦æˆåŠŸã€‚å®ƒåªå…³æ³¨å‘é€è¯·æ±‚ï¼Œå¹¶ä¸”ä»ä»æœåŠ¡å™¨æ”¶åˆ°å“åº”ã€‚è¿™æ„å‘³ç€å½“è¯·æ±‚å¤±è´¥æ—¶ï¼Œæˆ‘ä»¬éœ€è¦è‡ªå·±æŠ›å‡ºé”™è¯¯ã€‚  </p>
<p>å› æ­¤ï¼Œåœ¨ç¬¬ä¸€ä¸ª<code>.then</code>è¯·æ±‚ä¸­ï¼Œåªæœ‰å½“è¯·æ±‚æˆåŠŸæ—¶ï¼Œæ‰åº”è¯¥å¯¹è¿”å›çš„æ•°æ®è¿›è¡Œå¤„ç†ã€‚éªŒè¯è¯·æ±‚æ˜¯å¦æˆåŠŸå…¶å®å¾ˆç®€å•ï¼Œåªéœ€è¦åˆ¤æ–­<code>response</code>æ˜¯å¦ä¸º<code>ok</code>å°±å¯ä»¥äº†ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">fetch(<span class="string">&#x27;some-url&#x27;</span>)</span><br><span class="line">  .then(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (response.ok) &#123;</span><br><span class="line">      <span class="keyword">return</span> response.json()</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// Find some way to get to execute .catch()</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>

<p>å½“æˆ‘ä»¬çŸ¥é“æˆ‘ä»¬çš„è¯·æ±‚å¹¶æ²¡æœ‰æˆåŠŸæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡<code>throw</code>æŠ›å‡ºä¸€ä¸ªé”™è¯¯ï¼Œæˆ–è€…ä½¿ç”¨Promiseä¸­çš„<code>reject</code>å»æ¿€æ´»<code>catch</code>æ–¹æ³•ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// throwing an Error</span></span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;something went wrong!&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// rejecting a Promise</span></span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(<span class="string">&#x27;something went wrong!&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä»¥ä¸Šçš„ä¸¤ç§æ–¹å¼ï¼Œä½¿ç”¨ä»»æ„ä¸€ç§å°±å¯ä»¥äº†ã€‚å› ä¸ºè¿™ä¸¤ç§æ–¹å¼éƒ½å¯ä»¥æ¿€æ´»<code>.catch</code>æ–¹æ³•  </p>
<p>åœ¨è¿™é‡Œï¼Œæˆ‘é€‰æ‹©å»ä½¿ç”¨<code>Promise.reject</code>,å› ä¸ºå®ƒæ›´å®¹æ˜“å»æ‰§è¡Œã€‚<code>Errors</code>ä¹Ÿå¾ˆå¥½ï¼Œä½†æ˜¯å®ƒçš„æ‰§è¡Œæ¯”è¾ƒå›°éš¾ï¼Œå®ƒå”¯ä¸€çš„å¥½å¤„æ˜¯å®ƒåœ¨å †æ ˆè·Ÿè¸ªæ–¹é¢æœ‰ç€å¾—å¤©ç‹¬åšçš„ä¼˜åŠ¿ï¼Œä½†å†Fetchæ–¹æ³•ä¸­æˆ‘ä»¬å¹¶ä¸éœ€è¦è¿™ç§ç‰¹è´¨ã€‚  </p>
<p>æ‰€ä»¥ï¼Œä»£ç å°±å˜æˆäº†è¿™æ ·ï¼š </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">fetch(<span class="string">&#x27;https://api.github.com/users/chrissycoyier/repos&#x27;</span>)</span><br><span class="line">  .then(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (response.ok) &#123;</span><br><span class="line">      <span class="keyword">return</span> response.json()</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(<span class="string">&#x27;something went wrong!&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  .then(<span class="function"><span class="params">data</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&#x27;data is&#x27;</span>, data))</span><br><span class="line">  .catch(<span class="function"><span class="params">error</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">&#x27;error is&#x27;</span>, error));</span><br></pre></td></tr></table></figure>

<p><img src="/images/eFetch/error2.png" alt="image"></p>
<blockquote>
<p>Failed request, but error gets passed into catch correctly</p>
</blockquote>
<p>å¤ªå¥½äº†ï¼ï¼ç°åœ¨æˆ‘ä»¬æœ‰åŠæ³•å»æ•è·é”™è¯¯äº†ã€‚  </p>
<p>ä½†æ˜¯æˆ‘ä»¬è¿™æ ·å¤„ç†é”™è¯¯ä¿¡æ¯è¿”å›ä¸€ä¸ªæ™®é€šçš„æ–‡æœ¬å¹¶ä¸æ˜¯ç‰¹åˆ«çš„å‹å¥½ã€‚æˆ‘ä»¬å¹¶ä¸çŸ¥é“ç©¶ç«Ÿæ˜¯ä»€ä¹ˆåœ°æ–¹å‡ºé—®é¢˜äº†ã€‚æˆ‘ååˆ†ç¡®ä¿¡å†é‡åˆ°é”™è¯¯æ—¶æ”¶åˆ°è¿™æ ·ä¸€ä¸ªé”™è¯¯ä¿¡æ¯ä½ å¹¶ä¸ä¼šæ„Ÿåˆ°ååˆ†æ„‰å¿«ã€‚ã€‚ã€‚</p>
<p><img src="/images/Fetch/error3.png" alt="image"></p>
<blockquote>
<p>Yeahâ€¦ I get it that something went wrongâ€¦ but what exactly? ğŸ™</p>
</blockquote>
<p>åˆ°åº•æ˜¯ä»€ä¹ˆé”™äº†ï¼Ÿæ˜¯æœåŠ¡å™¨è¶…æ—¶äº†å—ï¼Ÿæ˜¯æˆ‘çš„è¿æ¥è¢«åˆ‡æ–­äº†å—ï¼Ÿæˆ‘ä»¬æ²¡æœ‰æ–¹æ³•å»å¾—çŸ¥ï¼æˆ‘ä»¬éœ€è¦ä¸€ç§æ–¹æ³•èƒ½å‘Šè¯‰æˆ‘ä»¬è¯·æ±‚å‘ç”Ÿäº†ä»€ä¹ˆé”™è¯¯ï¼Œç„¶åæˆ‘ä»¬å°±å¯ä»¥å¾ˆæ–¹ä¾¿çš„å¤„ç†å®ƒã€‚  </p>
<p>è®©æˆ‘ä»¬å†æ¥çœ‹ä¸€çœ‹è¿”å›çš„ä¿¡æ¯ï¼Œçœ‹èƒ½ä¸èƒ½æ‰¾åˆ°ä»€ä¹ˆçµæ„Ÿ</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  body: ReadableStream</span><br><span class="line">  bodyUsed: <span class="literal">true</span></span><br><span class="line">  headers: Headers</span><br><span class="line">  ok: <span class="literal">false</span> <span class="comment">// Response is not ok</span></span><br><span class="line">  redirected: <span class="literal">false</span></span><br><span class="line">  status: <span class="number">404</span> <span class="comment">// HTTP status is 404.</span></span><br><span class="line">  statusText: <span class="string">&quot;Not Found&quot;</span> <span class="comment">// Request not found</span></span><br><span class="line">  type: <span class="string">&quot;cors&quot;</span></span><br><span class="line">  url: <span class="string">&quot;https://api.github.com/users/chrissycoyier/repos&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>oh,å¤ªå¥½äº†ï¼åœ¨è¿™ä¸ªæ¡ˆä¾‹ä¸­ï¼Œé”™è¯¯çš„åŸå› æ˜¯æˆ‘ä»¬è¯·æ±‚çš„èµ„æºä¸å­˜åœ¨ã€‚æˆ‘ä»¬å¯ä»¥è¿”å›ä¸€ä¸ª404çŠ¶æ€ç ã€‚è¿™æ ·æˆ‘ä»¬å°±çŸ¥é“è¯¥åšä»€ä¹ˆäº†ã€‚  </p>
<p>å°†<code>status</code>å’Œ<code>statusText</code>æ”¾å…¥<code>.catch</code>æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>.reject</code>æ¥åšè¿™ä»¶äº‹:  </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">fetch(<span class="string">&#x27;some-url&#x27;</span>)</span><br><span class="line">  .then(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (response.ok) &#123;</span><br><span class="line">      <span class="keyword">return</span> response.json()</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(&#123;</span><br><span class="line">        status: response.status,</span><br><span class="line">        statusText: response.statusText</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">  .catch(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (error.status === <span class="number">404</span>) &#123;</span><br><span class="line">      <span class="comment">// do something about 404</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>

<p>å¥½ï¼ç°åœ¨æƒ³å¯¹äºä¹‹å‰å·²ç»æœ‰äº†å¾ˆå¤§çš„è¿›å±•äº†ï¼   </p>
<p>è¿™ç§é”™è¯¯å¤„ç†æ–¹å¼å¯¹äºä¸éœ€è¦ç‰¹å®šè§£é‡Šçš„é‚£äº›ç¡®å®šçš„HTTPçŠ¶æ€æ˜¯å·²ç»å®Œå…¨è¶³å¤Ÿäº†çš„ï¼Œåƒï¼š</p>
<ul>
<li>401: Unauthorized</li>
<li>404: Not found</li>
<li>408: Connection timeout</li>
</ul>
<p>ä½†æ˜¯å®ƒå¯¹äºè¿™ä¸€ç§æƒ…å†µå°±ä¼šæ˜¾å¾—ç‰¹åˆ«ä¸å‹å¥½ï¼š</p>
<ul>
<li>400: Bad request.</li>
</ul>
<p>æ˜¯ä»€ä¹ˆé€ æˆäº†ä¸€ä¸ªé”™è¯¯çš„è¯·æ±‚ï¼Ÿå¤ªå¤šçš„å¯èƒ½æ€§äº†ï¼ä¾‹å¦‚ï¼Œå¦‚æœä½ ä¸¢å¤±äº†ä¸€äº›å¿…è¦çš„å‚æ•°ï¼Œä¼šè¿”å›400ã€‚</p>
<p><img src="/images/Fetch/error4.png" alt="image"></p>
<blockquote>
<p>Stripeâ€™s explains it returns a 400 error if the request is missing a required field</p>
</blockquote>
<p>å¦‚æœæˆ‘ä»¬åªåƒä¹‹å‰ä¸€æ ·å¤„ç†çš„è¯ï¼Œé‚£ä¹ˆåªä¼šè¿”å›ä¸€ä¸ª400é”™è¯¯ã€‚æˆ‘ä»¬å°±ä¸çŸ¥é“ç©¶ç«Ÿå‘ç”Ÿäº†ä»€ä¹ˆã€‚æˆ‘ä»¬éœ€è¦æ›´å¤šçš„ä¿¡æ¯æ¥å‘Šè¯‰æˆ‘ä»¬ï¼Œç©¶ç«Ÿç¼ºå°‘äº†ä»€ä¹ˆï¼Ÿæ˜¯ç”¨æˆ·å¿˜è®°å¡«å†™äº†å§“åï¼Ÿé‚®ç®±ï¼Ÿè¿˜æ˜¯ä¿¡ç”¨å¡ä¿¡æ¯ï¼Ÿæˆ‘ä»¬å¹¶ä¸çŸ¥é“ã€‚  </p>
<p>ç†æƒ³çš„æ¥è¯´ï¼Œè¿™ç§æƒ…å†µä¸‹æœåŠ¡å™¨åº”è¯¥è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œå‘Šè¯‰æˆ‘ä»¬è¯·æ±‚ä¸ºä»€ä¹ˆä¼šå¤±è´¥ã€‚å¦‚æœä½ çš„åå°ä½¿ç”¨çš„æ˜¯nodeå’Œexpressï¼Œä½ å¯èƒ½ä¼šè¿™ä¹ˆå†™ã€‚  </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">res.status(<span class="number">400</span>).send(&#123;</span><br><span class="line">  err: <span class="string">&#x27;no first name&#x27;</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä¸èƒ½å†ç¬¬ä¸€ä¸ª<code>.then</code>æ–¹æ³•é‡Œä½¿ç”¨reject,å› ä¸ºæˆ‘ä»¬åªèƒ½åœ¨æ‰§è¡Œäº†<code>response.json</code>ä¹‹åæ‰èƒ½è¯»å–æœåŠ¡å™¨æŠ›å‡ºçš„é”™è¯¯ï¼Œç„¶åæˆ‘ä»¬æ‰èƒ½å†³å®šæˆ‘ä»¬åšäº›ä»€ä¹ˆã€‚  </p>
<p>å°±åƒä¸‹é¢è¿™äº›ä»£ç ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">fetch(<span class="string">&#x27;some-error&#x27;</span>)</span><br><span class="line">  .then(handleResponse)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">handleResponse</span>(<span class="params">response</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> response.json()</span><br><span class="line">    .then(<span class="function"><span class="params">json</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (response.ok) &#123;</span><br><span class="line">        <span class="keyword">return</span> json</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(json)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è®©æˆ‘ä»¬å‰–æä¸€ä¸‹è¿™ä¸€å¨ä»£ç ç©¶ç«Ÿåœ¨å¹²å•¥ï¼é¦–å…ˆæˆ‘ä»¬ä½¿ç”¨<code>response.json</code>æ¥è¯»å–æœåŠ¡å™¨è¿”å›ç»™æˆ‘ä»¬çš„jsonæ•°æ®ã€‚å› ä¸º<code>response.json</code>è¿”å›çš„æ˜¯ä¸€ä¸ªjsonå¯¹è±¡ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç«‹å³ä½¿ç”¨<code>.then</code>æ–¹æ³•å»è¯»å–è¿™ä¸ªæ•°æ®ç©¶ç«Ÿæ˜¯å•¥ã€‚  </p>
<p>æˆ‘ä»¬åœ¨ç¬¬ä¸€ä¸ª<code>.then</code>æ–¹æ³•é‡ŒåŒ…å«ç€ç¬¬äºŒä¸ª<code>.then</code>æ–¹æ³•å› ä¸ºæˆ‘ä»¬éœ€è¦å»åˆ¤æ–­<code>response.ok</code>æ˜¯å¦ä¸ºçœŸï¼Œä»è€Œåˆ¤æ–­å“åº”æ˜¯å¦æˆåŠŸ  </p>
<p>å¦‚æœä½ æƒ³å°† statuså’ŒstatusTextå’Œjsonä¸€èµ·å‘é€ç»™<code>.catch</code>,ä½ å¯ä»¥ä½¿ç”¨<code>Object.assign()</code>å°†å®ƒä»¬è”åˆåœ¨ä¸€èµ·ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> error = <span class="built_in">Object</span>.assign(&#123;&#125;, json, &#123;</span><br><span class="line">  status: response.status,</span><br><span class="line">  statusText: response.statusText</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error)</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨æ–°çš„<code>handelResponse</code>å‡½æ•°ï¼Œä½ å¯ä»¥è¿™æ ·ä¹¦å†™ä»£ç ã€‚è¿™ç§æ–¹å¼å¯ä»¥è‡ªåŠ¨å°†æ•°æ®å‘é€ç»™<code>.then</code>å’Œ<code>.catch</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">fetch(<span class="string">&#x27;some-url&#x27;</span>)</span><br><span class="line">  .then(handleResponse)</span><br><span class="line">  .then(<span class="function"><span class="params">data</span> =&gt;</span> <span class="built_in">console</span>.log(data))</span><br><span class="line">  .catch(<span class="function"><span class="params">error</span> =&gt;</span> <span class="built_in">console</span>.log(error))</span><br></pre></td></tr></table></figure>

<p>è¿™æ˜¯æˆ‘ä»¬ååˆ†é«˜å…´ï¼Œå› ä¸ºæˆ‘ä»¬æŠ˜è…¾äº†è€åŠå¤©ï¼Œç»ˆäºå®Œæˆäº†å¯¹é”™è¯¯çš„å¤„ç†ã€‚ä½†æ˜¯å½“æˆ‘ä»¬åä¸‹æ¥ï¼Œå–ç€å’–å•¡ï¼Œäº«å—ç€è¿™æƒ¬æ„çš„ä¸‹åˆèŒ¶çš„æ—¶å€™ã€‚æˆ‘ä»¬çªç„¶æ„è¯†åˆ°ã€‚ã€‚ã€‚æˆ‘ä»¬ä¼¼ä¹è¿˜æ²¡æœ‰å¯¹å“åº”æ•°æ®åšå¤„ç†ï¼ï¼ï¼</p>
<h3 id="å¤„ç†å…¶ä»–å“åº”ç±»å‹"><a href="#å¤„ç†å…¶ä»–å“åº”ç±»å‹" class="headerlink" title="å¤„ç†å…¶ä»–å“åº”ç±»å‹"></a>å¤„ç†å…¶ä»–å“åº”ç±»å‹</h3><p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬åªå¤„ç†äº†Fetchçš„jsonæ•°æ®è¯·æ±‚ã€‚è¿™åœ¨å½“ä»Š90%çš„APIéƒ½è¿”å›jsonæ•°æ®çš„æƒ…å†µä¸‹è§£å†³äº†å¤§éƒ¨åˆ†çš„é—®é¢˜ã€‚  </p>
<p>ä½†æ˜¯ï¼Œå¦å¤–çš„10%æ€ä¹ˆåŠã€‚ã€‚ã€‚  </p>
<p>å‡å¦‚ä½ ä½¿ç”¨ä¸Šé¢çš„ä»£ç å»æ¥å—XMLçš„å“åº”ï¼Œä½ å°†ç«‹å³æ•è·ä¸€ä¸ªé”™è¯¯ï¼š</p>
<p><img src="/images/Fetch/failed-text-response.png" alt="image"></p>
<blockquote>
<p>Parsing an invalid JSON produces a Syntax error</p>
</blockquote>
<p>å› ä¸ºè¿”å›çš„æ˜¯ä¸€ä¸²xmlæ•°æ®ï¼Œè€Œéjsonæ•°æ®ã€‚æœ€ç®€å•çš„ï¼Œæˆ‘ä»¬ä¸èƒ½è¿”å›<code>response.json</code>, å–è€Œä»£ä¹‹çš„æ˜¯<code>response.text</code>ã€‚æƒ³è¦è¿™ä¹ˆåšçš„è¯ï¼Œæˆ‘ä»¬éœ€è¦æ£€æŸ¥è¯·æ±‚å¤´é‡Œçš„ content type</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">.then(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">let</span> contentType = response.headers.get(<span class="string">&#x27;content-type&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (contentType.includes(<span class="string">&#x27;application/json&#x27;</span>)) &#123;</span><br><span class="line">    <span class="keyword">return</span> response.json()</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> (contentType.includes(<span class="string">&#x27;text/html&#x27;</span>)) &#123;</span><br><span class="line">    <span class="keyword">return</span> response.text()</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// Handle other responses accordingly...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



<p>ä¸‹é¢æ˜¯ä¹‹å‰æ‰€æœ‰ä»£ç çš„ä¸€ä¸ªåˆé›†ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">fetch(<span class="string">&#x27;some-url&#x27;</span>)</span><br><span class="line">  .then(handleResponse)</span><br><span class="line">  .then(<span class="function"><span class="params">data</span> =&gt;</span> <span class="built_in">console</span>.log(data))</span><br><span class="line">  .catch(<span class="function"><span class="params">error</span> =&gt;</span> <span class="built_in">console</span>.log(error))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">handleResponse</span> (<span class="params">response</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> contentType = response.headers.get(<span class="string">&#x27;content-type&#x27;</span>)</span><br><span class="line">  <span class="keyword">if</span> (contentType.includes(<span class="string">&#x27;application/json&#x27;</span>)) &#123;</span><br><span class="line">    <span class="keyword">return</span> handleJSONResponse(response)</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (contentType.includes(<span class="string">&#x27;text/html&#x27;</span>)) &#123;</span><br><span class="line">    <span class="keyword">return</span> handleTextResponse(response)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// Other response types as necessary. I haven&#x27;t found a need for them yet though.</span></span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">`Sorry, content-type <span class="subst">$&#123;contentType&#125;</span> not supported`</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">handleJSONResponse</span> (<span class="params">response</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> response.json()</span><br><span class="line">    .then(<span class="function"><span class="params">json</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (response.ok) &#123;</span><br><span class="line">        <span class="keyword">return</span> json</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(<span class="built_in">Object</span>.assign(&#123;&#125;, json, &#123;</span><br><span class="line">          status: response.status,</span><br><span class="line">          statusText: response.statusText</span><br><span class="line">        &#125;))</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">handleTextResponse</span> (<span class="params">response</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> response.text()</span><br><span class="line">    .then(<span class="function"><span class="params">text</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (response.ok) &#123;</span><br><span class="line">        <span class="keyword">return</span> json</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(&#123;</span><br><span class="line">          status: response.status,</span><br><span class="line">          statusText: response.statusText,</span><br><span class="line">          err: text</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚æœä½ å†³å®šä½¿ç”¨Fetchï¼Œé‚£ä¹ˆä½ å°†ä¼šç»å¸¸ä½¿ç”¨åˆ°<code>control</code>+<code>c</code>/<code>v</code>ã€‚å¦‚æœéœ€è¦åœ¨é¡¹ç›®ä¸­å¤§é‡ä½¿ç”¨Fetchçš„è¯ï¼Œä¸‹é¢ä»‹ç»äº†ä¸€ä¸ªFetchçš„åº“â€“zIFetch.</p>
<h3 id="ä»‹ç»-zIFetch"><a href="#ä»‹ç»-zIFetch" class="headerlink" title="ä»‹ç» zIFetch"></a>ä»‹ç» zIFetch</h3><p>zIFetchæ˜¯ä¸€ä¸ªæŠ½è±¡äº†æ•°æ®å¤„ç†å‡½æ•°çš„åº“ï¼Œå®ƒè®©ä½ åªéœ€è¦å…³å¿ƒæ•°æ®å’Œé”™è¯¯å¤„ç†è€Œä¸éœ€è¦æ‹…å¿ƒå“åº”ã€‚</p>
<p>ä½¿ç”¨zlFetchï¼Œé¦–å…ˆä½ å¯ä»¥è¿™ä¹ˆå®‰è£…å®ƒã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install zl-fetch --save</span><br></pre></td></tr></table></figure>

<p>ç„¶åï¼Œä½ å¯ä»¥åœ¨åº“é‡Œå¼•ç”¨å®ƒã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Polyfills (if needed)</span></span><br><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;isomorphic-fetch&#x27;</span>) <span class="comment">// or whatwg-fetch or node-fetch if you prefer</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ES6 Imports</span></span><br><span class="line"><span class="keyword">import</span> zlFetch <span class="keyword">from</span> <span class="string">&#x27;zl-fetch&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// CommonJS Imports</span></span><br><span class="line"><span class="keyword">const</span> zlFetch = <span class="built_in">require</span>(<span class="string">&#x27;zl-fetch&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>zIFetchä¸ä»…ä»…å¯ä»¥ç§»é™¤å¤„ç†Fetchå“åº”æ•°æ®çš„éœ€è¦ã€‚å®ƒè¿˜å¯ä»¥å¸®ä½ å‘é€æ•°æ®è€Œä¸éœ€è¦åœ¨bodyé‡Œå¯¹æ•°æ®è¿›è¡Œè½¬æ¢</p>
<p>ä¸‹é¢çš„è¿™äº›ä»£ç å°±æ˜¯ä¸€ä¸ªä¾‹å­ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> content = &#123;<span class="attr">some</span>: <span class="string">&#x27;content&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Post request with fetch</span></span><br><span class="line">fetch(<span class="string">&#x27;some-url&#x27;</span>, &#123;</span><br><span class="line">  method: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">  headers: &#123;<span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span>&#125;</span><br><span class="line">  body: <span class="built_in">JSON</span>.stringify(content)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Post request with zlFetch</span></span><br><span class="line">zlFetch(<span class="string">&#x27;some-url&#x27;</span>, &#123;</span><br><span class="line">  method: <span class="string">&#x27;post&#x27;</span>,</span><br><span class="line">  body: content</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>zIFetchè¿˜ä½¿å¾—web Tokensè®¤è¯å˜å¾—æ›´åŠ å®¹æ˜“</p>
<p>èº«ä»½éªŒè¯çš„æ ‡å‡†æ˜¯åœ¨å¤´éƒ¨æ·»åŠ ä¸€ä¸ª<code>Authorization</code>å¯†é’¥ã€‚<code>Authorization</code>çš„å†…å®¹å°†ä¼šè®¾ç½®åˆ°<code>Bearer your-token-here</code>ã€‚zlFetchå°†å¸®åŠ©ä½ æ·»åŠ è¿™ä¸ª<code>token</code>é…ç½®çš„å­—æ®µã€‚</p>
<p>æ‰€ä»¥ä¸‹é¢è¿™ä¸¤æ®µä»£ç å®é™…ä¸Šæ˜¯ç­‰ä»·çš„</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> token = <span class="string">&#x27;someToken&#x27;</span></span><br><span class="line">zlFetch(<span class="string">&#x27;some-url&#x27;</span>, &#123;</span><br><span class="line">  headers: &#123;</span><br><span class="line">    Authorization: <span class="string">`Bearer <span class="subst">$&#123;token&#125;</span>`</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Authentication with JSON Web Tokens with zlFetch</span></span><br><span class="line">zlFetch(<span class="string">&#x27;some-url&#x27;</span>, &#123;token&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>Fetchæ˜¯ä¸€é¡¹ååˆ†ç¥å¥‡çš„æŠ€æœ¯ï¼Œå®ƒä½¿å¾—æ”¶å‘æ¶ˆæ¯å˜å¾—æ›´åŠ å®¹æ˜“ã€‚æˆ‘ä»¬ä¸éœ€è¦ä½¿ç”¨XHRè¯·æ±‚ï¼Œä¹Ÿä¸éœ€è¦å¼•å…¥åƒjQueryä¸€æ ·çš„åº“ã€‚</p>
<p>å°½ç®¡Fetchå¾ˆå¥½ï¼Œä½†æ˜¯å®ƒå¤„ç†èµ·é”™è¯¯æ¥å´å¹¶ä¸ç®€å•ã€‚ä½ éœ€è¦å°†è®¸å¤šé”™è¯¯ä¿¡æ¯ä¼ é€’åˆ°<code>.catch</code>æ–¹æ³•ä¸­</p>
<p>ä½¿ç”¨zlFetchå¯ä»¥é¿å…è¿›è¡Œé”™è¯¯å¤„ç†ã€‚</p>
<h3 id="ref"><a href="#ref" class="headerlink" title="ref"></a>ref</h3><p><a target="_blank" rel="noopener" href="https://css-tricks.com/using-fetch/">Using Fetch</a> </p>

            <!--[if lt IE 9]><script>document.createElement('audio');</script><![endif]-->
            <audio id="audio" loop="1" preload="auto" controls="controls" data-autoplay="false">
                <source type="audio/mpeg" src="http://cdn.redrock.team/hello-student_music1.mp3">
            </audio>
            
        </div>
        
    <div id='gitalk-container' class="comment link"
		data-enable='true'
        data-ae='true'
        data-ci='b6ecefc4bbca5c566933'
        data-cs='ee266e05d6d467746681de2690e39a5aafe7276d'
        data-r='myjdml.github.io'
        data-o='myjdml'
        data-a='myjdml'
        data-d='true'
    >æŸ¥çœ‹è¯„è®º</div>


    </div>
    
</div>


    </div>
</div>
<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/z16.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":false},"log":false});</script></body>

<script src="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>


<script src="//lib.baomitu.com/jquery/1.8.3/jquery.min.js"></script>
<script src="/js/plugin.js"></script>
<script src="/js/typed.js"></script>
<script src="/js/diaspora.js"></script>


<link rel="stylesheet" href="/photoswipe/photoswipe.css">
<link rel="stylesheet" href="/photoswipe/default-skin/default-skin.css">


<script src="/photoswipe/photoswipe.min.js"></script>
<script src="/photoswipe/photoswipe-ui-default.min.js"></script>


<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>
    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">
        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>
        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">
            <div class="pswp__top-bar">
                <!--  Controls are self-explanatory. Order can be changed. -->
                <div class="pswp__counter"></div>
                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
                <button class="pswp__button pswp__button--share" title="Share"></button>
                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>
            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>
            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>
            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>
            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>
        </div>
    </div>
</div>






</html>
